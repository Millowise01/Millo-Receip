<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>European Dishes</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <div class="logo">
      <h1>Millo's Cuisine Explorer</h1>
    </div>
    <nav>
      <a href="index.html">Home</a>
      <a href="african.html">African Dishes</a>
      <a href="asian.html">Asian Dishes</a>
      <a href="european.html">European Dishes</a>
      <a href="american.html">American Dishes</a>
    </nav>
  </header>

  <main>
    <h2>European Dishes</h2>
    <div class="loading" id="loading">Loading recipes...</div>
    <div class="recipes-container" id="recipes-container"></div>
  </main>

  <script>
    const API_BASE_URL = '/api';
    const API_KEY = 'secure-api-key-2024';
    const europeanCountries = ['Italian', 'French', 'Spanish', 'British', 'German'];

    async function apiRequest(url) {
      const response = await fetch(url, {
        headers: { 'X-API-Key': API_KEY }
      });
      return response.json();
    }

    async function loadEuropeanRecipes() {
      try {
        const allMeals = [];
        for (const country of europeanCountries) {
          try {
            const data = await apiRequest(`${API_BASE_URL}/recipes/area/${country}`);
            if (data.success && data.meals) {
              allMeals.push(...data.meals.slice(0, 4)); // Limit to 4 per country
            }
          } catch (error) {
            console.log(`No recipes found for ${country}`);
          }
        }
        
        if (allMeals.length > 0) {
          displayRecipes(allMeals);
        } else {
          document.getElementById('recipes-container').innerHTML = '<p>No European recipes found.</p>';
        }
      } catch (error) {
        document.getElementById('recipes-container').innerHTML = '<p>Error loading recipes.</p>';
      }
      document.getElementById('loading').style.display = 'none';
    }

    function displayRecipes(meals) {
      const container = document.getElementById('recipes-container');
      container.innerHTML = meals.map(meal => `
        <div class="dish-card">
          <img src="${meal.strMealThumb}" alt="${meal.strMeal}" loading="lazy">
          <h3>${meal.strMeal}</h3>
          <button onclick="showRecipeDetails('${meal.idMeal}')">View Full Recipe</button>
        </div>
      `).join('');
    }

    async function showRecipeDetails(mealId) {
      try {
        const data = await apiRequest(`${API_BASE_URL}/recipes/details/${mealId}`);
        if (data.success && data.meal) {
          displayMealModal(data.meal);
        }
      } catch (error) {
        alert('Error loading recipe details');
      }
    }

    function displayMealModal(meal) {
      const ingredients = getIngredientsList(meal);
      const modal = document.createElement('div');
      modal.className = 'modal';
      modal.innerHTML = `
        <div class="modal-content">
          <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
          <h2>${meal.strMeal}</h2>
          <img src="${meal.strMealThumb}" alt="${meal.strMeal}" style="width: 100%; max-width: 400px;">
          <h3>Ingredients:</h3>
          <ul>${ingredients}</ul>
          <h3>Instructions:</h3>
          <p>${meal.strInstructions}</p>
        </div>
      `;
      document.body.appendChild(modal);
    }

    function getIngredientsList(meal) {
      let ingredients = '';
      for (let i = 1; i <= 20; i++) {
        const ingredient = meal[`strIngredient${i}`];
        const measure = meal[`strMeasure${i}`];
        if (ingredient && ingredient.trim()) {
          ingredients += `<li>${ingredient} - ${measure || ''}</li>`;
        }
      }
      return ingredients;
    }

    document.addEventListener('DOMContentLoaded', loadEuropeanRecipes);
  </script>

  <footer>
    <p>&copy; 2025 Millo's Cuisine Explorer. All rights reserved.</p>
  </footer>
</body>
</html>